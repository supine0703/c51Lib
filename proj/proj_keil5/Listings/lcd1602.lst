C51 COMPILER V9.60.7.0   LCD1602                                                           12/04/2023 07:06:34 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE LCD1602
OBJECT MODULE PLACED IN .\Objects\lcd1602.obj
COMPILER INVOKED BY: E:\Keil C51\C51\BIN\C51.EXE ..\src\lcd1602.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\include) DEBUG OBJE
                    -CTEXTEND PRINT(.\Listings\lcd1602.lst) OBJECT(.\Objects\lcd1602.obj)

line level    source

   1          #include "lcd1602.h"
   2          
   3          // #define WAIT 1 // 12MHz 72能正常运行 400可以让33MHz正常运行
   4          /**
   5           * 写数据和写命令完全不需要在最后加上delay，如果连续执行不正常，就是CheckBus
             -y有问题。
   6           */
   7          
   8          // -------------------------------------
   9          
  10          void LCD1602_CheckBusy(void)
  11          {
  12   1              unsigned char busy;
  13   1              LCD1602_DATA = 0xff;
  14   1              do
  15   1              {       busy = 0xff;
  16   2                      LCD1602_EN = 0;
  17   2                      LCD1602_RS = 0;
  18   2                      LCD1602_RW = 1;
  19   2                      LCD1602_EN = 1;
  20   2                      busy = LCD1602_DATA;
  21   2              } while (busy & 0x80);
  22   1              LCD1602_EN = 0;
  23   1      }
  24          
  25          void LCD1602_WriteByte(bit rs, unsigned char byte);
  26          
  27          void LCD1602_WriteCmd(unsigned char cmd)
  28          { if (!cmd) return; LCD1602_WriteByte(0, cmd); }
  29          
  30          void LCD1602_WriteData(unsigned char dat)
  31          { LCD1602_WriteByte(1, dat); }
  32          
  33          #ifndef LCD1602_NO_READDATA
              unsigned char LCD1602_ReadData(void)
              {
                      unsigned char dat;
                      LCD1602_CheckBusy();
                      LCD1602_DATA = 0xff;
                      LCD1602_RW   = 1;
                      LCD1602_RS   = 1;
                      LCD1602_EN   = 1;
                      dat = LCD1602_DATA;
                      LCD1602_EN   = 0;
                      return dat;
              }
              #endif
  47          
  48          // -------------------------------------
  49          
  50          extern void _nop_(void);
  51          
  52          //void LCD1602_Wait(unsigned int t)
  53          //{ do { } while (t--); }
C51 COMPILER V9.60.7.0   LCD1602                                                           12/04/2023 07:06:34 PAGE 2   

  54          
  55          void LCD1602_WriteByte(bit rs, unsigned char byte)
  56          {
  57   1              LCD1602_CheckBusy();
  58   1              LCD1602_RW   = 0;
  59   1              LCD1602_RS   = rs;      // 0 写命令  1 写数据
  60   1              LCD1602_DATA = byte;
  61   1              LCD1602_EN   = 1;       // LCD1602_EN: 0 -> 1
  62   1              _nop_();
  63   1              LCD1602_EN   = 0;
  64   1              //LCD1602_Wait(WAIT);
  65   1      }
  66          
  67          // -------------------------------------


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     56    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

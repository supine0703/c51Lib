C51 COMPILER V9.60.7.0   UTILITY                                                           12/01/2023 01:42:17 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE UTILITY
OBJECT MODULE PLACED IN .\Objects\utility.obj
COMPILER INVOKED BY: E:\Keil C51\C51\BIN\C51.EXE utility.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\include) DEBUG OBJECTEXTEN
                    -D PRINT(.\Listings\utility.lst) OBJECT(.\Objects\utility.obj)

line level    source

   1          #define uchar unsigned char
   2          #define uint  unsigned int
   3          
   4          // @param num: 数字  str: 存储地址  length: 数据可存储大小  decimal: 小数位数
   5          void FloatToString(float num, uchar* str, uchar length, uchar decimal)
   6          {
   7   1          char i, mid;
   8   1          uint intn, decn;
   9   1          float dec, std = 0.4;
  10   1      
  11   1          // 确定小数点的位置
  12   1          if (decimal != 0)
  13   1          {
  14   2              if (decimal + (num < 0) + 1 > length)
  15   2              {
  16   3                  mid = num < 0;
  17   3                  decimal = length - 1 - (num < 0);
  18   3              }
  19   2              else
  20   2                  mid = length - decimal - 1;
  21   2              str[mid] = '.';
  22   2          }
  23   1          else
  24   1              mid = length;
  25   1      
  26   1          // 五舍六入
  27   1          i = decimal;
  28   1          while (i--)
  29   1              std *= 0.1;
  30   1      
  31   1          // 分离整数和小数部分
  32   1          if (num < 0)
  33   1          {
  34   2              num -= std;
  35   2              intn = -(int)num;
  36   2              dec = (int)num - num;
  37   2          }
  38   1          else
  39   1          {
  40   2              num += std;
  41   2              intn = (int)num;
  42   2              dec = num - intn;
  43   2          }
  44   1      
  45   1          // 处理小数部分
  46   1          for (i = mid + 1; i < length; ++i)
  47   1          {
  48   2              dec *= 10;
  49   2              decn = (uchar)dec;
  50   2              str[i] = decn + '0';
  51   2              dec -= decn;
  52   2          }
  53   1          // 处理整数部分
  54   1          for (i = mid - 1; i > 0; --i)
C51 COMPILER V9.60.7.0   UTILITY                                                           12/01/2023 01:42:17 PAGE 2   

  55   1          {
  56   2              str[i] = intn % 10 + '0';
  57   2              intn /= 10;
  58   2              if (intn == 0)
  59   2              {
  60   3                  --i;
  61   3                  break;
  62   3              }
  63   2          }
  64   1          str[i] = num < 0 ? '-' : (intn == 0 && mid != 1 ? ' ' : intn % 10 + '0');
  65   1          while (i-- > 0)
  66   1              str[i] = ' ';
  67   1      }
  68          
  69          void Int8ToString(char num, uchar* str, uchar length)
  70          {
  71   1          bit neg = num < 0;
  72   1          if (!length)
  73   1              return;
  74   1          if (neg)
  75   1          {
  76   2              if (!--length)
  77   2                  return;
  78   2              ++str;
  79   2              num = ~num;
  80   2              ++num;
  81   2          }
  82   1          str[--length] = num % 10 + '0';
  83   1          while (length)
  84   1          {
  85   2              num /= 10;
  86   2              if (!num)
  87   2                  break;
  88   2              str[--length] = num % 10 + '0';
  89   2          }
  90   1          if (neg)
  91   1          {
  92   2              --str;
  93   2              if (!length)
  94   2                  *str = '-';
  95   2              str[length] = '-';
  96   2          }
  97   1          while (length)
  98   1              str[--length] = ' ';
  99   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    841    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      28
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

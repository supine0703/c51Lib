C51 COMPILER V9.60.7.0   LR                                                                11/21/2023 00:14:12 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE LR
OBJECT MODULE PLACED IN .\Objects\lr.obj
COMPILER INVOKED BY: E:\Keil C51\C51\BIN\C51.EXE lr.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\lr.ls
                    -t) OBJECT(.\Objects\lr.obj)

line level    source

   1          #include "ultimste.h"
   2          #include <intrins.h>
   3          
   4          uchar start1[] = "AHAU CHINA";
   5          uchar start2[] = "I LOVE YOU";
   6          uchar main1[]  = "Temperature";
   7          uchar main2[]  = "     ";
   8          
   9          uchar count = 0;
  10          
  11          void LCD1602Action(void);
  12          void ShowTemp(uint t);
  13          void ShowTemper(uint t);
  14          
  15          void timer0() interrupt 1
  16          {
  17   1              TH0 = 0x4c;
  18   1              TL0 = 0x00;
  19   1              ++count;
  20   1      }
  21          
  22          
  23          void main(void)
  24          {
  25   1              //uchar key, sure = 0, enter = 0; // 一些标志
  26   1              //DS_Retemp();
  27   1              Start_Convert();
  28   1              
  29   1              TMOD = 0x01;
  30   1              TH0 = 0x4c;
  31   1              TL0 = 0x00;
  32   1              EA = 1;
  33   1              ET0 = 1;
  34   1              TR0 = 1;
  35   1              
  36   1              LCD1602Action();        // lcd1602 初始化（开机）
  37   1              Delay(1);
  38   1              while (1)
  39   1              {
  40   2                      ShowTemper(0);
  41   2                      //ShowTemp(0);  // 显示温度
  42   2                      Delay(1);
  43   2              } 
  44   1              
  45   1              /*
  46   1              LCD_SetCursorFirstLine(7);
  47   1              LCD_ShowString("a:", 100);
  48   1              LCD_WriteData('0');
  49   1              // LCD_ShowString(number, 0);
  50   1              LCD_CursorShiftLeft();
  51   1              LCD_CursorFlicher(); // 打开光标闪烁
  52   1              while (1)
  53   1              {
  54   1                      key = P3 >> 4;
C51 COMPILER V9.60.7.0   LR                                                                11/21/2023 00:14:12 PAGE 2   

  55   1                      switch (key)
  56   1                      {
  57   1                              case 0x0e:                              // s4
  58   1                                      Delay(10);                      // 去抖
  59   1                                      if (!enter && key == P3 >> 4)
  60   1                                      {       // 锁定当前数字 关闭光标闪烁
  61   1                                              enter = 1;
  62   1                                              sure = 1;
  63   1                                              LCD_CursorOFF();
  64   1                                      }
  65   1                                      break;
  66   1                              case 0x0d:                              // s3
  67   1                                      Delay(10);
  68   1                                      if (!enter && !sure && key == P3 >> 4)
  69   1                                      {       // 数字0-9循环减1
  70   1                                              enter = 1;
  71   1                                              num = LCD_ReadData();
  72   1                                              LCD_CursorShiftLeft();
  73   1                                              num += num == 48 ? 9 : -1;
  74   1                                              LCD_WriteData(num);
  75   1                                              // number[0] += number[0] == 48 ? 9 : -1;
  76   1                                              //LCD_ShowString(number, 0);
  77   1                                              LCD_CursorShiftLeft();
  78   1                                      }
  79   1                                      break;
  80   1                              case 0x0b:                              // s2
  81   1                                      Delay(10);
  82   1                                      if (!enter && !sure && key == P3 >> 4)
  83   1                                      {       // 数字0-9循环加1
  84   1                                              enter = 1;
  85   1                                              num = LCD_ReadData();
  86   1                                              LCD_CursorShiftLeft();
  87   1                                              num += num == 57 ? -9 : 1;
  88   1                                              LCD_WriteData(num);
  89   1                                              //number[0] += number[0] == 57 ? -9 : 1;
  90   1                                              //LCD_ShowString(number, 0);
  91   1                                              LCD_CursorShiftLeft();
  92   1                                      }
  93   1                                      break;
  94   1                              case 0x07:                              // s1
  95   1                                      Delay(100);
  96   1                                      if (!enter && key == P3 >> 4)
  97   1                                      {       // 将a的值清零
  98   1                                              enter = 1;
  99   1                                              sure = 0;
 100   1                                              LCD_CursorFlicher();
 101   1                                              number[0] = 48;
 102   1                                              LCD_ShowString(number, 0);
 103   1                                              LCD_CursorShiftLeft();
 104   1                                      }
 105   1                                      break;
 106   1                              case 0x0F:
 107   1                                      // 解除按键锁定 每次按下将按键锁定，防止频繁触发按键效果
 108   1                                      enter = 0;
 109   1                      }
 110   1              }
 111   1              */
 112   1      }
 113          
 114          void LCD1602Action(void)
 115          {
 116   1              uchar signal[] = " C";
C51 COMPILER V9.60.7.0   LR                                                                11/21/2023 00:14:12 PAGE 3   

 117   1              LCD1602_Initial(); // 初始化
 118   1              // 开机界面
 119   1              LCD1602_SetCursorFirstLine(17);         // 设置光标在显示屏之外
 120   1              LCD1602_ShowString(start1, 0);
 121   1              LCD1602_SetCursorSecondLine(17);
 122   1              LCD1602_Mode_ScreenRightMove();         // 一边输出第二行子一边移动屏幕
 123   1              LCD1602_ShowString(start2, 100);
 124   1              LCD1602_Mode_CursorRightMove();         // 恢复光标自增
 125   1              LCD1602_ScreenMultipleRight(4, 100);// 字体移动居中
 126   1              LCD1602_ScreenFlicker(3, 500);          // 闪烁三次
 127   1              LCD1602_ScreenMultipleRight(12, 100);
 128   1              LCD1602_Clear();                                        // 清屏
 129   1              Delay(100);
 130   1              // 初始化显示
 131   1              LCD1602_CursorON();                                     // 设置光标
 132   1              LCD1602_SetCursorFirstLine(3);
 133   1              LCD1602_ShowString(main1, 100);
 134   1      
 135   1              signal[0] = 0xdf;
 136   1              //ShowTemp(100);
 137   1              ShowTemper(100);
 138   1              LCD1602_ShowString(signal, 100);
 139   1              LCD1602_CursorOFF();
 140   1      }
 141          
 142          void ShowTemp(uint t)
 143          {
 144   1              LCD1602_SetCursorSecondLine(4);
 145   1              NumberToString(DS_Retemp() * 0.0625, main2, 5, 1);
 146   1              LCD1602_ShowString(main2, t);
 147   1      }
 148          
 149          void ShowTemper(uint t)
 150          {
 151   1              int temper;
 152   1              while (count < 2) { }
 153   1              LCD1602_SetCursorSecondLine(4);
 154   1              temper = Read_temper();
 155   1              Start_Convert();
 156   1              count = 0;
 157   1              NumberToString(temper * 0.0625, main2, 5, 1);
 158   1              LCD1602_ShowString(main2, t);
 159   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    342    ----
   CONSTANT SIZE    =      3    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     41       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
